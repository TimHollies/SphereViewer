!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("three")):"function"==typeof define&&define.amd?define(["three"],t):"object"==typeof exports?exports.SphereViewer=t(require(void 0)):e.SphereViewer=t(e.THREE)}(this,function(e){return function(e){function t(o){if(i[o])return i[o].exports;var n=i[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var i={};return t.m=e,t.c=i,t.i=function(e){return e},t.d=function(e,i,o){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=5)}([function(t,i){t.exports=e},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BallSpinnerLoader=void 0;var o=i(0),n=function(e){e=e||{},this.groupRadius=e.groupRadius||10,this.circleCount=e.circleCount||8,this.circleRadius=e.circleRadius||1,this.groupAngle=0,this.animationAmplitude=e.animationAmplitude||10,this.circles=[],this.mesh=this.initGroup()};n.prototype={makeCircle:function(e){e=e||{};var t=e.radius||5,i=e.segments||16,n=new o.CircleGeometry(t,i),s=new o.MeshBasicMaterial({color:16777215,transparent:!0,opacity:e.opacity,side:o.DoubleSide});return{mesh:new o.Mesh(n,s),opacityStep:e.opacityStep||.01}},addToScene:function(e){e.add(this.mesh)},initGroup:function(){for(var e=new o.Object3D,t=0,i=1/(this.circleCount/2+1),n=.02,s=0,a=2*Math.PI/this.circleCount,r=0;r<this.circleCount;r++){t+=i,t>1&&(t=1-i,i=-i,n=-n);var h=this.makeCircle({opacity:t,opacityStep:n,radius:this.circleRadius}),c=this.polar2cartesian({distance:this.groupRadius,radians:s});h.mesh.position.set(c.x,c.y,t*this.animationAmplitude),s+=a,e.add(h.mesh),this.circles.push(h)}return e},polar2cartesian:function(e){return{x:Math.round(e.distance*Math.cos(e.radians)*1e3)/1e3,y:Math.round(e.distance*Math.sin(e.radians)*1e3)/1e3}},animate:function(){this.mesh.rotation.z+=.02;for(var e=this.circles,t=(this.circleCount,0);t<e.length;t++){var i=e[t],o=i.mesh.material.opacity+i.opacityStep;i.mesh.geometry.radius;o>1?(o=1-i.opacityStep,i.opacityStep=-i.opacityStep):o<0&&(o=i.opacityStep,i.opacityStep=-i.opacityStep),i.mesh.material.opacity=o,i.mesh.position.z=o*this.animationAmplitude}}},t.BallSpinnerLoader=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ProgressiveImgLoader=void 0;var o=i(0),n=function(){},s=n.prototype=Object.create(o.EventDispatcher.prototype);s.load=function(e){var t=this,i=new o.Texture,n=t.imageObj=new Image,s=0;return n.crossOrigin="anonymous",n.onload=function(){t.imageObj&&(i.needsUpdate=!0,s<e.length?(t.dispatchEvent({type:"progress",imageIndex:s}),window.setTimeout(function(){n.src=e[s++]},1e3)):(t.dispatchEvent({type:"done"}),t.imageObj=null))},n.src=e[s++],i.image=n,i},s.dispose=function(){this.imageObj&&(this.imageObj.src=""),this.imageObj=null},t.ProgressiveImgLoader=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SphereControls=void 0;var o=i(0),n=function(e,t,i){function n(e){u.dispatchEvent({type:"tap",original:e}),e.preventDefault(),m=!0,d(),g.position.lon=o.Math.radToDeg(g.position.theta),g.position.lat=90-o.Math.radToDeg(g.position.phi),f.x=e.clientX,f.y=e.clientY,f.lon=g.position.lon,f.lat=g.position.lat}function s(e){!0===m&&(g.position.lon=.1*(f.x-e.clientX)+f.lon,g.position.lat=.1*(e.clientY-f.y)+f.lat),u.dispatchEvent({type:"mouseMove",original:e})}function a(e){m=!1,e.preventDefault(),l()}function r(t){e.fov+=.05*t.deltaY,e.updateProjectionMatrix()}function h(e){1==e.touches.length&&(m=!0,d(),u.dispatchEvent({type:"tap",original:e}),e.preventDefault(),e.stopPropagation(),f.x=e.touches[0].pageX,f.y=e.touches[0].pageY,g.position.lon=o.Math.radToDeg(g.position.theta),g.position.lat=90-o.Math.radToDeg(g.position.phi),f.lon=g.position.lon,f.lat=g.position.lat)}function c(e){1==e.touches.length&&(e.preventDefault(),e.stopPropagation(),g.position.lon=.1*(f.x-e.touches[0].pageX)+f.lon,g.position.lat=.1*(e.touches[0].pageY-f.y)+f.lat)}function p(e){m=!1,l()}function d(){M.suspended=!0,M.timeout&&window.clearTimeout(M.timeout)}function l(){M.enabled&&(M.timeout=window.setTimeout(function(){M.timeout=null,M.suspended=!1},M.delay))}var u=this;i=i||{},t=void 0!==t?t:document,t.addEventListener("mousedown",n,!1),t.addEventListener("mousemove",s,!1),t.addEventListener("mouseup",a,!1),t.addEventListener("wheel",r,!1),t.addEventListener("touchstart",h,!1),t.addEventListener("touchend",p,!1),t.addEventListener("touchmove",c,!1);var m=!1,f={x:null,y:null,lat:null,lon:null},g={position:{lon:90,lat:0,phi:Math.PI/2,theta:0},time:5},v={position:{phi:g.position.phi,theta:g.position.theta},time2:1},y=new o.Vector3,w={phi:0,theta:0},M={enabled:!!i.autoRotate,suspended:!i.autoRotate,speed:Math.max(0,Math.min(10,i.autoRotateSpeed||1))/1e3*(-1===i.autoRotateDirection?-1:1),delay:Math.max(i.autoRotateDelay||5e3,1e3),timeout:null};this.update=function(){if(m)g.position.lat=Math.max(-85,Math.min(85,g.position.lat)),g.position.phi=o.Math.degToRad(90-g.position.lat),g.position.theta=o.Math.degToRad(g.position.lon),w={phi:g.position.phi-v.position.phi,theta:g.position.theta-v.position.theta},g.time=5,v.time2=1;else{var t=g.time*g.time/60;g.time++,w.phi=w.phi*v.time2/t,w.theta=w.theta*v.time2/t,v.time2=t,M.suspended||(w.theta=M.speed<0?Math.min(w.theta,M.speed):Math.max(w.theta,M.speed)),g.position.phi+=w.phi,g.position.theta+=w.theta,g.position.phi>Math.PI?(g.position.phi=Math.PI,w.phi=-1*w.phi):g.position.phi<0&&(g.position.phi=0,w.phi=-1*w.phi)}v.position.phi=g.position.phi,v.position.theta=g.position.theta,y.x=500*Math.sin(g.position.phi)*Math.cos(g.position.theta),y.y=500*Math.cos(g.position.phi),y.z=500*Math.sin(g.position.phi)*Math.sin(g.position.theta),e.lookAt(y)}};n.prototype=Object.create(o.EventDispatcher.prototype),t.SphereControls=n},function(e,t,i){"use strict";function o(e,t){this.isDisposed=!1,this.config=t=t||{},t.showCloseButton=!!t.showCloseButton,this.initViewport(),this.initScene(),this.initSphere(e),this.config.logo&&this.initLogo(this.config.logo,void 0===this.config.logoDistance?-15:this.config.logoDistance),this.config.hint&&this.showHint(this.config.hint),this.initControls(),this.onResize=this.onResize.bind(this),window.addEventListener("resize",this.onResize,!1),window.setTimeout(this.onResize,1),this.render()}Object.defineProperty(t,"__esModule",{value:!0}),t.Viewer=o;var n=i(0),s=i(3),a=i(2),r=i(1),h=o.prototype=Object.create(n.EventDispatcher.prototype);h.initViewport=function(){var e=(window.devicePixelRatio,window.screen.availWidth,1/window.devicePixelRatio),t=$('head meta[name="viewport"]');this.originalViewPortMeta=t.attr("content"),t.attr("content","initial-scale="+e+", maximum-scale="+e+", user-scalable=0");var i=1!==window.devicePixelRatio;this.container=document.createElement("div"),this.container.className="sphere-container "+(i?"isMobile":"isDesktop"),this.config.showCloseButton&&(this.closeButton=document.createElement("i"),this.closeButton.className="cmdCloseSphere material-icons",this.closeButton.innerHTML="highlight_off",this.container.appendChild(this.closeButton),this.closeButton_onClick=this.closeButton_onClick.bind(this),this.closeButton.addEventListener("click",this.closeButton_onClick)),document.getElementsByTagName("body")[0].appendChild(this.container)},h.closeButton_onClick=function(){this.dispose()},h.controls_onTap=function(e){this.hideHint()},h.initScene=function(){var e=document.getElementsByTagName("body")[0];this.renderer=new n.WebGLRenderer,this.renderer.setSize(e.scrollWidth,e.scrollHeight),this.container.appendChild(this.renderer.domElement),this.scene=new n.Scene;this.camera=new n.PerspectiveCamera(90,1,1,1e3),this.scene.add(this.camera)},h.initSphere=function(e){this.imgLoader=new a.ProgressiveImgLoader,this.loader_onDone=this.loader_onDone.bind(this),this.imgLoader.addEventListener("done",this.loader_onDone);var t=new n.SphereGeometry(100,64,64);this.config.uvMapper&&this.config.uvMapper(t),this.sphere=new n.Mesh(t,new n.MeshBasicMaterial({map:this.imgLoader.load(e),side:n.FrontSide})),this.sphere.scale.x=-1,this.scene.add(this.sphere),this.showLoader()},h.initLogo=function(e,t){var i=new n.TextureLoader,o=this;i.crossOrigin="",i.load(e,function(e){o.logo=new n.Mesh(new n.PlaneGeometry(10,10),new n.MeshBasicMaterial({map:e,side:n.FrontSide,transparent:!0,opacity:1})),o.logo.position.set(0,t,0),o.logo.rotation.x=-Math.PI/2,o.scene.add(o.logo)})},h.showHint=function(e){var t=new n.TextureLoader,i=this;t.crossOrigin="",t.load(e,function(e){i.hint=new n.Mesh(new n.PlaneGeometry(10,10),new n.MeshBasicMaterial({map:e,side:n.FrontSide,transparent:!0,opacity:1})),i.hint.position.set(0,0,-30),i.camera.add(i.hint)})},h.hideHint=function(){this.hint&&(this.camera.remove(this.hint),this.hint=null)},h.initControls=function(){this.controls=new s.SphereControls(this.camera,this.renderer.domElement,this.config.control),this.controls_onTap=this.controls_onTap.bind(this),this.controls.addEventListener("tap",this.controls_onTap)},h.onResize=function(e){var t=this.container.offsetWidth,i=this.container.offsetHeight;this.camera&&(this.camera.aspect=t/i,this.camera.updateProjectionMatrix()),this.renderer.setSize(t,i)},h.render=function(){this.isDisposed||(requestAnimationFrame(this.render.bind(this)),this.dispatchEvent({type:"preRender",original:event}),this.controls&&this.controls.update(),this.spinLoader&&this.spinLoader.animate(),this.renderer.render(this.scene,this.camera))},h.showLoader=function(){this.spinLoader=new r.BallSpinnerLoader(this.config.spinner),this.camera.add(this.spinLoader.mesh),this.spinLoader.mesh.position.set(0,0,-50)},h.hideLoader=function(){this.spinLoader&&(this.camera.remove(this.spinLoader.mesh),this.spinLoader=null)},h.loader_onDone=function(){this.loader_onDone=null,this.hideLoader()},h.dispose=function(){window.removeEventListener("resize",this.onResize),this.closeButton&&this.closeButton.removeEventListener("click",this.closeButton_onClick),this.controls.removeEventListener("tap",this.controls_onTap),this.imgLoader.dispose(),this.isDisposed=!0,this.container.remove(),$('head meta[name="viewport"]').attr("content",this.originalViewPortMeta),this.loaderEl=this.imgLoader=this.closeButton=this.container=this.renderer=this.container=this.camera=this.scene=this.sphere=this.controls=null}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=i(4);Object.defineProperty(t,"Viewer",{enumerable:!0,get:function(){return o.Viewer}});var n=i(1);Object.defineProperty(t,"BallSpinnerLoader",{enumerable:!0,get:function(){return n.BallSpinnerLoader}});var s=i(3);Object.defineProperty(t,"SphereControls",{enumerable:!0,get:function(){return s.SphereControls}});var a=i(2);Object.defineProperty(t,"ProgressiveImgLoader",{enumerable:!0,get:function(){return a.ProgressiveImgLoader}})}])});